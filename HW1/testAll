#!/bin/bash

#parameter $1 list of tests

DIR=$PWD

: '
if [ -d "${DIR}/.logFiles" ]; then 
    echo ".logFiles dir exists, exiting"
    exit 1
else 
'

    mkdir .logFiles
    (( line_num = 1 ))
    (( failed_num = 0 ))
    (( success_num = 0 ))
    
    while read line ; do
        IFS='@'
        line_split=($line)
        IFS=' '
        
        : '
        echo ${line_split[0]}
        echo ${line_split[1]}
        echo ${line_split[2]}
        echo ${line_split[3]}
        '
        
        echo "${line_num}: ${line_split[0]}"
        
        ./testCompilation ".logFiles/${line_num}.compile.log" "${line_split[1]}"
        (( failed_num = $failed_num + $? ))
        
        ./testInOut ".logFiles/${line_num}.inout.log" "${line_split[1]}" "${line_split[2]}" "${line_split[3]}"
         (( failed_num = $failed_num + $? ))
         
        ./testMemLeaks ".logFiles/${line_num}.memory.log" "${line_split[1]}" "${line_split[2]}"
        (( failed_num = $failed_num + $? ))
        
        (( line_num = line_num + 1 ))
        

    done < $1
    
    (( test_num = ($line_num - 1) * 3 ))
    (( passed_num = $line_num - $failed_num ))
    echo  "passed ${passed_num} of ${test_num} tests" 

    echo $test 
#fi
